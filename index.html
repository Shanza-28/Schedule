<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Study Time Tracker - Multiple Subject Charts</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet" />
  <style>
    :root {
      --color-bg: #fefefe;
      --color-bg-gradient: linear-gradient(135deg, #f9fafb 0%, #e2e8f0 100%);
      --color-text: #222222;
      --color-primary: #3182ce;
      --color-primary-dark: #2b6cb0;
      --color-error: #e53e3e;
      --color-form-bg: #fff;
      --color-border: #cbd5e0;
      --color-shadow: rgba(99, 99, 99, 0.1);
      --color-chart-bg: #fff;
      --font-family: 'Inter', sans-serif;
    }
    [data-theme='dark'] {
      --color-bg: #121212;
      --color-bg-gradient: linear-gradient(135deg, #1f2937 0%, #111827 100%);
      --color-text: #e2e8f0;
      --color-primary: #63b3ed;
      --color-primary-dark: #4299e1;
      --color-error: #fc8181;
      --color-form-bg: #1e293b;
      --color-border: #374151;
      --color-shadow: rgba(0, 0, 0, 0.7);
      --color-chart-bg: #1e293b;
    }
    * {
      box-sizing: border-box;
    }
    body {
      font-family: var(--font-family);
      background: var(--color-bg-gradient);
      margin: 0;
      padding: 2rem 1rem;
      color: var(--color-text);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      transition: background 0.4s ease, color 0.4s ease;
    }
    h1 {
      font-weight: 600;
      margin-bottom: 2rem;
      color: var(--color-text);
      text-align: center;
      font-size: 1.9rem;
      user-select: none;
    }
    .toggle-wrapper {
      position: fixed;
      top: 1rem;
      right: 1rem;
      user-select: none;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-weight: 600;
      color: var(--color-text);
      cursor: pointer;
    }
    .toggle-switch {
      position: relative;
      width: 50px;
      height: 26px;
      display: inline-block;
    }
    .toggle-switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }
    .slider {
      position: absolute;
      cursor: pointer;
      background-color: #ccc;
      border-radius: 34px;
      top: 0; left: 0; right: 0; bottom: 0;
      transition: 0.4s;
    }
    .slider:before {
      position: absolute;
      content: "";
      height: 20px; width: 20px;
      left: 3px; bottom: 3px;
      background-color: white;
      border-radius: 50%;
      transition: 0.4s;
    }
    input:checked + .slider {
      background-color: var(--color-primary);
    }
    input:checked + .slider:before {
      transform: translateX(24px);
    }
    .container {
      background: var(--color-form-bg);
      max-width: 640px;
      width: 100%;
      border-radius: 12px;
      padding: 2rem 2.5rem 3rem;
      box-shadow: 0 8px 24px var(--color-shadow);
      transition: background 0.4s ease, box-shadow 0.4s ease;
      user-select: none;
      margin-bottom: 3rem;
    }
    form {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem 1.5rem;
      margin-bottom: 1.5rem;
      justify-content: space-between;
    }
    label {
      flex: 1 1 200px;
      display: flex;
      flex-direction: column;
      font-weight: 600;
      font-size: 1rem;
      color: var(--color-text);
    }
    input[type="date"],
    input[type="number"],
    input[type="text"] {
      margin-top: 0.4rem;
      padding: 0.7rem 1rem;
      border: 1.8px solid var(--color-border);
      border-radius: 10px;
      font-size: 1.1rem;
      background: var(--color-bg);
      color: var(--color-text);
      transition: border-color 0.3s ease, background 0.3s ease, color 0.3s ease;
      outline-offset: 2px;
    }
    input[type="date"]:focus,
    input[type="number"]:focus,
    input[type="text"]:focus {
      outline: none;
      border-color: var(--color-primary);
      box-shadow: 0 0 8px var(--color-primary);
    }
    .error-msg {
      color: var(--color-error);
      font-weight: 500;
      font-size: 0.85rem;
      margin-top: 0.2rem;
      min-height: 1.2rem;
    }
    button[type="submit"],
    #resetBtn {
      background: var(--color-primary);
      color: white;
      border: none;
      padding: 0.9rem 2rem;
      border-radius: 12px;
      font-size: 1.15rem;
      cursor: pointer;
      font-weight: 700;
      flex: 1 1 100%;
      max-width: 240px;
      transition: background-color 0.3s ease;
      user-select: none;
    }
    button[type="submit"]:hover:not(:disabled) {
      background: var(--color-primary-dark);
    }
    button[type="submit"]:disabled {
      background: #a0aec0;
      cursor: not-allowed;
    }
    #resetBtn {
      background: var(--color-error);
      margin-top: 0;
      margin-bottom: 1.5rem;
      max-width: 100%;
      font-weight: 600;
      user-select: none;
    }
    #resetBtn:hover {
      background: #c53030;
    }
    .charts-wrapper {
      max-width: 640px;
      width: 100%;
    }
    .chart-block {
      margin-bottom: 3rem;
      background: var(--color-form-bg);
      padding: 1.3rem 1.5rem 2rem;
      border-radius: 12px;
      box-shadow: 0 8px 24px var(--color-shadow);
      user-select: none;
    }
    .chart-block h2 {
      font-weight: 600;
      color: var(--color-text);
      margin-bottom: 1rem;
      border-left: 5px solid var(--color-primary);
      padding-left: 0.8rem;
      user-select: none;
    }
    canvas {
      background: var(--color-chart-bg);
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(99, 99, 99, 0.07);
      width: 100% !important;
      max-height: 320px;
      transition: background 0.4s ease;
      user-select: none;
    }
    @media (max-width: 600px) {
      form {
        flex-direction: column;
      }
      button[type="submit"],
      #resetBtn {
        max-width: 100%;
      }
      label {
        flex: 1 1 100%;
      }
    }
  </style>
</head>
<body>

  <div class="toggle-wrapper" title="Toggle dark mode">
    <label for="darkModeToggle">Dark Mode</label>
    <label class="toggle-switch">
      <input type="checkbox" id="darkModeToggle" />
      <span class="slider"></span>
    </label>
  </div>

  <h1>ðŸ“š Study Time Tracker</h1>

  <div class="container">
    <form id="studyForm" autocomplete="off" novalidate>
      <label for="date">
        Date
        <input type="date" id="date" required />
        <span class="error-msg" id="dateError"></span>
      </label>
      <label for="hours">
        Hours Studied
        <input type="number" id="hours" min="0" max="24" step="0.1" placeholder="e.g. 2" required />
        <span class="error-msg" id="hoursError"></span>
      </label>
      <label for="subject">
        Subject (optional)
        <input type="text" id="subject" placeholder="Math, History, etc." maxlength="30" />
        <span class="error-msg" id="subjectError"></span>
      </label>
      <button type="submit" id="addBtn" disabled>Add Entry</button>
    </form>

    <button id="resetBtn" title="Reset all data (password protected)">Reset Data</button>
  </div>

  <div class="charts-wrapper" id="chartsWrapper">
    <!-- Dynamic charts appear here -->
  </div>

  <script>
    const STORAGE_KEY = 'studyData';

    let studyData = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];

    const form = document.getElementById('studyForm');
    const dateInput = document.getElementById('date');
    const hoursInput = document.getElementById('hours');
    const subjectInput = document.getElementById('subject');
    const addBtn = document.getElementById('addBtn');
    const resetBtn = document.getElementById('resetBtn');
    const dateError = document.getElementById('dateError');
    const hoursError = document.getElementById('hoursError');
    const subjectError = document.getElementById('subjectError');
    const chartsWrapper = document.getElementById('chartsWrapper');

    const darkModeToggle = document.getElementById('darkModeToggle');

    // Initialize date input to today
    dateInput.valueAsDate = new Date();

    // Validate inputs function
    function validateInputs() {
      let valid = true;

      const selectedDate = new Date(dateInput.value);
      const today = new Date();
      today.setHours(0,0,0,0);

      if (!dateInput.value) {
        dateError.textContent = 'Please select a date.';
        valid = false;
      } else if (selectedDate > today) {
        dateError.textContent = 'Date cannot be in the future.';
        valid = false;
      } else {
        dateError.textContent = '';
      }

      const hoursVal = parseFloat(hoursInput.value);
      if (hoursInput.value === '') {
        hoursError.textContent = 'Please enter hours studied.';
        valid = false;
      } else if (isNaN(hoursVal) || hoursVal <= 0 || hoursVal > 24) {
        hoursError.textContent = 'Hours must be between 0.1 and 24.';
        valid = false;
      } else {
        hoursError.textContent = '';
      }

      if (subjectInput.value.length > 30) {
        subjectError.textContent = 'Subject name too long.';
        valid = false;
      } else {
        subjectError.textContent = '';
      }

      addBtn.disabled = !valid;
      return valid;
    }

    dateInput.addEventListener('input', validateInputs);
    hoursInput.addEventListener('input', validateInputs);
    subjectInput.addEventListener('input', validateInputs);

    // Group data by subject, then by date
    // Output: { subject: { date: totalHours, ... }, ... }
    function groupDataBySubject(data) {
      const grouped = {};
      data.forEach(entry => {
        const subj = entry.subject || 'Unspecified';
        if (!grouped[subj]) grouped[subj] = {};
        grouped[subj][entry.date] = (grouped[subj][entry.date] || 0) + entry.hours;
      });
      return grouped;
    }

    // Get all unique dates from data
    function getAllDates(data) {
      const datesSet = new Set();
      data.forEach(entry => {
        datesSet.add(entry.date);
      });
      return Array.from(datesSet).sort((a,b) => new Date(a) - new Date(b));
    }

    // Color palette
    const baseColors = [
      '#3182ce', // blue
      '#38a169', // green
      '#dd6b20', // orange
      '#d53f8c', // pink
      '#718096', // gray
      '#b7791f', // yellow-ish
      '#805ad5', // purple
      '#e53e3e', // red
    ];
    function getColor(index) {
      return baseColors[index % baseColors.length];
    }

    // Keep Chart.js chart instances so we can destroy before redraw
    let charts = [];

    function clearCharts() {
      charts.forEach(c => c.destroy());
      charts = [];
      chartsWrapper.innerHTML = '';
    }

    function createChartCanvas(subject) {
      const div = document.createElement('div');
      div.className = 'chart-block';

      const title = document.createElement('h2');
      title.textContent = subject;
      div.appendChild(title);

      const canvas = document.createElement('canvas');
      div.appendChild(canvas);

      chartsWrapper.appendChild(div);
      return canvas.getContext('2d');
    }

    function updateCharts() {
      clearCharts();

      if (studyData.length === 0) {
        chartsWrapper.innerHTML = '<p style="text-align:center; color: var(--color-text); font-style: italic;">No data to display. Add some study entries!</p>';
        return;
      }

      const grouped = groupDataBySubject(studyData);
      const allDates = getAllDates(studyData);

      let subjectIndex = 0;
      for (const subject in grouped) {
        const ctx = createChartCanvas(subject);

        // Prepare data array for this subject aligned with allDates
        const dataPoints = allDates.map(date => grouped[subject][date] || 0);

        const chart = new Chart(ctx, {
          type: 'bar',
          data: {
            labels: allDates,
            datasets: [{
              label: subject,
              data: dataPoints,
              backgroundColor: getColor(subjectIndex),
              borderRadius: 6,
              borderSkipped: false,
            }],
          },
          options: {
            responsive: true,
            plugins: {
              legend: { display: false },
              tooltip: {
                callbacks: {
                  label: ctx => `${ctx.dataset.label}: ${ctx.parsed.y} hr${ctx.parsed.y !== 1 ? 's' : ''}`
                }
              }
            },
            scales: {
              x: {
                title: {
                  display: true,
                  text: 'Date',
                  font: { size: 14, weight: '600' }
                },
                ticks: {
                  maxRotation: 90,
                  minRotation: 45,
                  autoSkip: true,
                  maxTicksLimit: 10,
                },
                grid: { display: false },
              },
              y: {
                beginAtZero: true,
                max: 24,
                title: {
                  display: true,
                  text: 'Hours Studied',
                  font: { size: 14, weight: '600' }
                },
                ticks: {
                  stepSize: 2
                },
                grid: {
                  color: 'rgba(0,0,0,0.05)'
                }
              }
            }
          }
        });
        charts.push(chart);
        subjectIndex++;
      }
    }

    // Save data to localStorage
    function saveData() {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(studyData));
    }

    // Add new entry handler
    form.addEventListener('submit', e => {
      e.preventDefault();
      if (!validateInputs()) return;

      const newEntry = {
        date: dateInput.value,
        hours: parseFloat(hoursInput.value),
        subject: subjectInput.value.trim() || 'Unspecified',
      };

      studyData.push(newEntry);
      saveData();
      updateCharts();

      // Clear hours and subject but keep date for convenience
      hoursInput.value = '';
      subjectInput.value = '';
      validateInputs();
    });

    // Reset button
    resetBtn.addEventListener('click', () => {
      const pw = prompt('Enter password to reset all data:');
      if (pw === 'reset123') {
        studyData = [];
        saveData();
        updateCharts();
        alert('All data reset.');
      } else if (pw !== null) {
        alert('Wrong password. Data not reset.');
      }
    });

    // Dark mode toggle
    function loadTheme() {
      const theme = localStorage.getItem('theme') || 'light';
      document.documentElement.setAttribute('data-theme', theme);
      darkModeToggle.checked = theme === 'dark';
    }
    function saveTheme(theme) {
      localStorage.setItem('theme', theme);
    }
    darkModeToggle.addEventListener('change', () => {
      const theme = darkModeToggle.checked ? 'dark' : 'light';
      document.documentElement.setAttribute('data-theme', theme);
      saveTheme(theme);
    });

    // Initialize page
    window.onload = () => {
      loadTheme();
      validateInputs();
      updateCharts();
    };
  </script>

</body>
</html>
