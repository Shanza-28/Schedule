<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Study Time Tracker</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet" />
<style>
  :root {
    --color-bg: #fefefe;
    --color-bg-gradient: linear-gradient(135deg, #f9fafb 0%, #e2e8f0 100%);
    --color-text: #222222;
    --color-primary: #3182ce;
    --color-primary-dark: #2b6cb0;
    --color-error: #e53e3e;
    --color-form-bg: #fff;
    --color-border: #cbd5e0;
    --color-shadow: rgba(99, 99, 99, 0.1);
    --color-chart-bg: #fff;
  }

  [data-theme='dark'] {
    --color-bg: #121212;
    --color-bg-gradient: linear-gradient(135deg, #1f2937 0%, #111827 100%);
    --color-text: #e2e8f0;
    --color-primary: #63b3ed;
    --color-primary-dark: #4299e1;
    --color-error: #fc8181;
    --color-form-bg: #1e293b;
    --color-border: #374151;
    --color-shadow: rgba(0, 0, 0, 0.7);
    --color-chart-bg: #1e293b;
  }

  * {
    box-sizing: border-box;
  }
  body {
    font-family: 'Inter', sans-serif;
    background: var(--color-bg-gradient);
    margin: 0;
    padding: 2rem 1rem;
    color: var(--color-text);
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    transition: background 0.4s ease, color 0.4s ease;
  }
  h1 {
    font-weight: 600;
    margin-bottom: 1rem;
    color: var(--color-text);
    display: flex;
    align-items: center;
    justify-content: center;
  }

  /* Dark Mode Toggle Switch */
  .toggle-wrapper {
    position: fixed;
    top: 1rem;
    right: 1rem;
    user-select: none;
  }
  .toggle-switch {
    position: relative;
    width: 50px;
    height: 26px;
    display: inline-block;
  }
  .toggle-switch input {
    opacity: 0;
    width: 0;
    height: 0;
  }
  .slider {
    position: absolute;
    cursor: pointer;
    background-color: #ccc;
    border-radius: 34px;
    top: 0; left: 0; right: 0; bottom: 0;
    transition: 0.4s;
  }
  .slider:before {
    position: absolute;
    content: "";
    height: 20px; width: 20px;
    left: 3px; bottom: 3px;
    background-color: white;
    border-radius: 50%;
    transition: 0.4s;
  }
  input:checked + .slider {
    background-color: var(--color-primary);
  }
  input:checked + .slider:before {
    transform: translateX(24px);
  }

  .toggle-label {
    font-weight: 600;
    margin-right: 0.5rem;
    font-size: 0.9rem;
    color: var(--color-text);
    vertical-align: middle;
  }

  .container {
    background: var(--color-form-bg);
    max-width: 700px;
    width: 100%;
    border-radius: 12px;
    padding: 2rem 2.5rem;
    box-shadow: 0 8px 24px var(--color-shadow);
    transition: background 0.4s ease, box-shadow 0.4s ease;
  }
  form {
    display: flex;
    flex-wrap: wrap;
    gap: 1.25rem 1.5rem;
    margin-bottom: 1.5rem;
    justify-content: space-between;
  }
  label {
    flex: 1 1 200px;
    display: flex;
    flex-direction: column;
    font-weight: 600;
    font-size: 0.95rem;
    color: var(--color-text);
  }
/* Existing styles (unchanged) */
input[type="date"],
input[type="number"],
input[type="text"] {
  margin-top: 0.4rem;
  padding: 0.6rem 0.75rem;
  border: 1.8px solid var(--color-border);
  border-radius: 8px;
  font-size: 1rem;
  background: var(--color-bg);
  color: var(--color-text);
  transition: border-color 0.3s ease, background 0.3s ease, color 0.3s ease;
}

input[type="date"]:focus,
input[type="number"]:focus,
input[type="text"]:focus {
  outline: none;
  border-color: var(--color-primary);
  box-shadow: 0 0 6px var(--color-primary);
}

button[type="submit"],
#resetBtn {
  background: var(--color-primary);
  color: white;
  border: none;
  padding: 0.8rem 1.8rem;
  border-radius: 10px;
  font-size: 1.05rem;
  cursor: pointer;
  flex: 1 1 100%;
  max-width: 240px;
  font-weight: 600;
  transition: background-color 0.25s ease;
  align-self: flex-end;
}

button[type="submit"]:hover {
  background: var(--color-primary-dark);
}

#resetBtn {
  background: var(--color-error);
  margin-top: 0;
  margin-bottom: 1.5rem;
}

#resetBtn:hover {
  background: #c53030;
}

/* âœ… Responsive enhancements */
@media screen and (max-width: 600px) {
  form {
    display: flex;
    flex-direction: column;
    gap: 0.75rem; 
  }

  input[type="date"],
  input[type="number"],
  input[type="text"],
  button[type="submit"],
  #resetBtn {
    margin-top :0px;
    width: 100%;
    max-width: 100%;
    box-sizing: border-box;
  }

  button[type="submit"],
  #resetBtn {
    align-self: stretch;
  }
}

  .chart-container {
    margin-bottom: 3rem;
  }
  h2 {
    font-weight: 600;
    color: var(--color-text);
    margin-bottom: 0.75rem;
    border-left: 5px solid var(--color-primary);
    padding-left: 0.75rem;
  }
  canvas {
    background: var(--color-chart-bg);
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(99, 99, 99, 0.05);
    width: 100% !important;
    max-height: 350px;
    transition: background 0.4s ease;
  }
  @media (max-width: 600px) {
    form {
      flex-direction: column;
    }
    button[type="submit"],
    #resetBtn {
      max-width: 100%;
    }
  }
</style>
</head>
<body>

<!-- The entire app container to toggle visibility -->
<div id="app" style="display:none;">
  <div class="toggle-wrapper" title="Toggle dark mode">
    <label class="toggle-label" for="darkModeToggle">Dark Mode</label>
    <label class="toggle-switch">
      <input type="checkbox" id="darkModeToggle" />
      <span class="slider"></span>
    </label>
  </div>

  <h1>ðŸ“š Study Time Tracker</h1>

  <div class="container">
    <form id="studyForm" autocomplete="off">
      <label for="date">Date
        <input type="date" id="date" required />
      </label>
      <label for="hours">Hours Studied
        <input type="number" id="hours" min="0" step="0.1" placeholder="e.g. 2" required />
      </label>
      <label for="subject">Subject (optional)
        <input type="text" id="subject" placeholder="Math, History, etc." />
      </label>
      <button type="submit">Add Entry</button>
    </form>

    <button id="resetBtn">Reset Data</button>

    <div class="chart-container">
      <h2>Daily Study Time (Hours)</h2>
      <canvas id="lineChart"></canvas>
    </div>

    <div class="chart-container">
      <h2>Weekly Study Time by Subject</h2>
      <canvas id="barChart"></canvas>
    </div>

    <div class="chart-container">
      <h2>Monthly Total Study Time</h2>
      <canvas id="monthlyLineChart"></canvas>
    </div>

    <div class="chart-container">
      <h2>Monthly Study Time by Subject</h2>
      <canvas id="pieChart"></canvas>
    </div>
  </div>
</div>

<script>
  // ======= Password Gate Logic =======
  const MASTER_ACCESS_KEY = 'mypassword2025'; // CHANGE this to your "paid user" password

  // Track if user has access in localStorage so they don't need to enter again
  const ACCESS_GRANTED_KEY = 'studyAppAccessGranted';

  function askPassword() {
    let attempts = 3;
    while (attempts > 0) {
      const input = prompt('Enter your access password:');
      if (input === null) {
        alert('Access denied: password required.');
        attempts = 0;
        break;
      }
      if (input === MASTER_ACCESS_KEY) {
        localStorage.setItem(ACCESS_GRANTED_KEY, 'true');
        return true;
      }
      attempts--;
      alert(`Incorrect password. ${attempts} attempt(s) left.`);
    }
    return false;
  }

  function checkAccess() {
    if (localStorage.getItem(ACCESS_GRANTED_KEY) === 'true') {
      return true;
    }
    return askPassword();
  }

  // If access denied, do nothing more
  if (!checkAccess()) {
    document.body.innerHTML = '<h1 style="color:#e53e3e; text-align:center; margin-top: 3rem;">Access Denied</h1>';
  } else {
    document.getElementById('app').style.display = 'block';

    // ====== Existing Code Starts Here ======
    const form = document.getElementById('studyForm');
    const dateInput = document.getElementById('date');
    const hoursInput = document.getElementById('hours');
    const subjectInput = document.getElementById('subject');
    const resetBtn = document.getElementById('resetBtn');

    // Dark Mode toggle
    const darkModeToggle = document.getElementById('darkModeToggle');

    // Load dark mode preference
    if(localStorage.getItem('darkMode') === 'enabled'){
      document.documentElement.setAttribute('data-theme', 'dark');
      darkModeToggle.checked = true;
    }

    darkModeToggle.addEventListener('change', () => {
      if (darkModeToggle.checked) {
        document.documentElement.setAttribute('data-theme', 'dark');
        localStorage.setItem('darkMode', 'enabled');
      } else {
        document.documentElement.removeAttribute('data-theme');
        localStorage.setItem('darkMode', 'disabled');
      }
    });

    // Validate and initialize date input to today
    function formatDate(date) {
      return date.toISOString().split('T')[0];
    }
    dateInput.value = formatDate(new Date());

    // Study log storage key
    const STORAGE_KEY = 'studyLogs';

    // Get logs from localStorage or empty array
    function getLogs() {
      const logs = JSON.parse(localStorage.getItem(STORAGE_KEY));
      return logs ? logs : [];
    }

    // Save logs to localStorage
    function saveLogs(logs) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(logs));
    }

    // Add a log entry
    function addLog(date, hours, subject) {
      const logs = getLogs();
      logs.push({ date, hours, subject });
      saveLogs(logs);
    }

    // Reset data with password
    resetBtn.addEventListener('click', () => {
      const resetPassword = prompt('Enter password to reset data:');
      if (resetPassword === 'abc123') {
        localStorage.removeItem(STORAGE_KEY);
        alert('Data reset successfully.');
        location.reload();
      } else {
        alert('Incorrect reset password.');
      }
    });

    // Handle form submission
    form.addEventListener('submit', e => {
      e.preventDefault();

      const date = dateInput.value;
      const hours = parseFloat(hoursInput.value);
      const subject = subjectInput.value.trim();

      if (!date) {
        alert('Please select a valid date.');
        return;
      }
      if (isNaN(hours) || hours <= 0) {
        alert('Please enter a valid number of hours greater than 0.');
        return;
      }

      addLog(date, hours, subject);
      alert('Entry added.');

      // Reset form fields
      hoursInput.value = '';
      subjectInput.value = '';
      dateInput.value = formatDate(new Date());

      // Update charts
      updateCharts();
    });

    // ========== Chart Setup ==========

    // Create charts
    const lineCtx = document.getElementById('lineChart').getContext('2d');
    const barCtx = document.getElementById('barChart').getContext('2d');
    const monthlyLineCtx = document.getElementById('monthlyLineChart').getContext('2d');
    const pieCtx = document.getElementById('pieChart').getContext('2d');

    let lineChart, barChart, monthlyLineChart, pieChart;

    function createLineChart(labels, data) {
      if (lineChart) lineChart.destroy();
      lineChart = new Chart(lineCtx, {
        type: 'line',
        data: {
          labels,
          datasets: [{
            label: 'Hours Studied',
            data,
            borderColor: 'var(--color-primary)',
            backgroundColor: 'rgba(49,130,206,0.25)',
            fill: true,
            tension: 0.3,
            pointRadius: 4,
            pointHoverRadius: 6,
          }]
        },
        options: {
          responsive: true,
          scales: {
            y: {
              beginAtZero: true,
              title: { display: true, text: 'Hours' }
            },
            x: {
              title: { display: true, text: 'Date' }
            }
          },
          plugins: {
            legend: { display: true }
          }
        }
      });
    }

    function createBarChart(labels, datasets) {
      if (barChart) barChart.destroy();
      barChart = new Chart(barCtx, {
        type: 'bar',
        data: { labels, datasets },
        options: {
          responsive: true,
          scales: {
            y: {
              beginAtZero: true,
              title: { display: true, text: 'Hours' }
            },
            x: {
              title: { display: true, text: 'Weekday' }
            }
          },
          plugins: {
            legend: { position: 'top' }
          }
        }
      });
    }

    function createMonthlyLineChart(labels, data) {
      if (monthlyLineChart) monthlyLineChart.destroy();
      monthlyLineChart = new Chart(monthlyLineCtx, {
        type: 'line',
        data: {
          labels,
          datasets: [{
            label: 'Total Hours',
            data,
            borderColor: 'var(--color-primary-dark)',
            backgroundColor: 'rgba(66,153,225,0.3)',
            fill: true,
            tension: 0.3,
            pointRadius: 4,
            pointHoverRadius: 6,
          }]
        },
        options: {
          responsive: true,
          scales: {
            y: {
              beginAtZero: true,
              title: { display: true, text: 'Hours' }
            },
            x: {
              title: { display: true, text: 'Month' }
            }
          }
        }
      });
    }

    function createPieChart(labels, data) {
      if (pieChart) pieChart.destroy();
      pieChart = new Chart(pieCtx, {
        type: 'pie',
        data: {
          labels,
          datasets: [{
            label: 'Hours',
            data,
            backgroundColor: [
              '#3182ce', '#63b3ed', '#63a69f', '#9f63b3', '#b3639f', '#d53f8c',
              '#ed64a6', '#f6ad55', '#ed8936', '#48bb78', '#38a169', '#2f855a',
            ],
            borderColor: '#fff',
            borderWidth: 2
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: { position: 'right' }
          }
        }
      });
    }

    // ========== Data Processing for Charts ==========
    function updateCharts() {
      const logs = getLogs();

      if (logs.length === 0) {
        // No data, clear charts
        if(lineChart) lineChart.clear();
        if(barChart) barChart.clear();
        if(monthlyLineChart) monthlyLineChart.clear();
        if(pieChart) pieChart.clear();
        return;
      }

      // Sort logs by date ascending
      logs.sort((a, b) => new Date(a.date) - new Date(b.date));

      // -------- Line Chart: daily total hours --------
      const dailyMap = {};
      logs.forEach(({date, hours}) => {
        dailyMap[date] = (dailyMap[date] || 0) + hours;
      });
      const dailyLabels = Object.keys(dailyMap);
      const dailyData = Object.values(dailyMap);
      createLineChart(dailyLabels, dailyData);

      // -------- Bar Chart: weekly study time by subject --------
      // For simplicity, weekdays as labels:
      const weekdays = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
      // We'll group by weekday and subject
      // Example: { Math: [hours on Sun, Mon, ... Sat], History: [...] }
      const subjectWeekdayMap = {};
      logs.forEach(({date, hours, subject}) => {
        const dayIndex = new Date(date).getDay();
        const subj = subject || 'No Subject';
        if (!subjectWeekdayMap[subj]) {
          subjectWeekdayMap[subj] = new Array(7).fill(0);
        }
        subjectWeekdayMap[subj][dayIndex] += hours;
      });
      const datasets = Object.entries(subjectWeekdayMap).map(([subject, data], i) => {
        const colors = [
          '#3182ce', '#63b3ed', '#63a69f', '#9f63b3', '#b3639f',
          '#d53f8c', '#ed64a6', '#f6ad55', '#ed8936', '#48bb78',
        ];
        return {
          label: subject,
          data,
          backgroundColor: colors[i % colors.length]
        };
      });
      createBarChart(weekdays, datasets);

      // -------- Monthly total study time --------
      // Group by YYYY-MM
      const monthlyMap = {};
      logs.forEach(({date, hours}) => {
        const month = date.slice(0,7);
        monthlyMap[month] = (monthlyMap[month] || 0) + hours;
      });
      const monthlyLabels = Object.keys(monthlyMap).sort();
      const monthlyData = monthlyLabels.map(month => monthlyMap[month]);
      createMonthlyLineChart(monthlyLabels, monthlyData);

      // -------- Monthly study time by subject (pie) --------
      // Aggregate total hours by subject
      const subjectTotals = {};
      logs.forEach(({hours, subject}) => {
        const subj = subject || 'No Subject';
        subjectTotals[subj] = (subjectTotals[subj] || 0) + hours;
      });
      const pieLabels = Object.keys(subjectTotals);
      const pieData = Object.values(subjectTotals);
      createPieChart(pieLabels, pieData);
    }

    // Initial update
    updateCharts();
  }
</script>
</body>
</html>

