<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Study Time Tracker</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet" />
<style>
  /* Same styling as before */
  :root {
    --color-bg: #fefefe;
    --color-bg-gradient: linear-gradient(135deg, #f9fafb 0%, #e2e8f0 100%);
    --color-text: #222222;
    --color-primary: #3182ce;
    --color-primary-dark: #2b6cb0;
    --color-error: #e53e3e;
    --color-form-bg: #fff;
    --color-border: #cbd5e0;
    --color-shadow: rgba(99, 99, 99, 0.1);
    --color-chart-bg: #fff;
  }

  [data-theme='dark'] {
    --color-bg: #121212;
    --color-bg-gradient: linear-gradient(135deg, #1f2937 0%, #111827 100%);
    --color-text: #e2e8f0;
    --color-primary: #63b3ed;
    --color-primary-dark: #4299e1;
    --color-error: #fc8181;
    --color-form-bg: #1e293b;
    --color-border: #374151;
    --color-shadow: rgba(0, 0, 0, 0.7);
    --color-chart-bg: #1e293b;
  }

  * {
    box-sizing: border-box;
  }
  body {
    font-family: 'Inter', sans-serif;
    background: var(--color-bg-gradient);
    margin: 0;
    padding: 2rem 1rem;
    color: var(--color-text);
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    transition: background 0.4s ease, color 0.4s ease;
  }
  h1 {
    font-weight: 600;
    margin-bottom: 1rem;
    color: var(--color-text);
    display: flex;
    align-items: center;
    justify-content: center;
  }

  /* Dark Mode Toggle Switch */
  .toggle-wrapper {
    position: fixed;
    top: 1rem;
    right: 1rem;
    user-select: none;
  }
  .toggle-switch {
    position: relative;
    width: 50px;
    height: 26px;
    display: inline-block;
  }
  .toggle-switch input {
    opacity: 0;
    width: 0;
    height: 0;
  }
  .slider {
    position: absolute;
    cursor: pointer;
    background-color: #ccc;
    border-radius: 34px;
    top: 0; left: 0; right: 0; bottom: 0;
    transition: 0.4s;
  }
  .slider:before {
    position: absolute;
    content: "";
    height: 20px; width: 20px;
    left: 3px; bottom: 3px;
    background-color: white;
    border-radius: 50%;
    transition: 0.4s;
  }
  input:checked + .slider {
    background-color: var(--color-primary);
  }
  input:checked + .slider:before {
    transform: translateX(24px);
  }

  .toggle-label {
    font-weight: 600;
    margin-right: 0.5rem;
    font-size: 0.9rem;
    color: var(--color-text);
    vertical-align: middle;
  }

  .container {
    background: var(--color-form-bg);
    max-width: 700px;
    width: 100%;
    border-radius: 12px;
    padding: 2rem 2.5rem;
    box-shadow: 0 8px 24px var(--color-shadow);
    transition: background 0.4s ease, box-shadow 0.4s ease;
  }
  form {
    display: flex;
    flex-wrap: wrap;
    gap: 1.25rem 1.5rem;
    margin-bottom: 1.5rem;
    justify-content: space-between;
    align-items: flex-end;
  }
  label {
    flex: 1 1 140px;
    display: flex;
    flex-direction: column;
    font-weight: 600;
    font-size: 0.95rem;
    color: var(--color-text);
  }
  input[type="date"],
  input[type="number"],
  input[type="text"] {
    margin-top: 0.4rem;
    padding: 0.6rem 0.75rem;
    border: 1.8px solid var(--color-border);
    border-radius: 8px;
    font-size: 1rem;
    background: var(--color-bg);
    color: var(--color-text);
    transition: border-color 0.3s ease, background 0.3s ease, color 0.3s ease;
  }

  input[type="date"]:focus,
  input[type="number"]:focus,
  input[type="text"]:focus {
    outline: none;
    border-color: var(--color-primary);
    box-shadow: 0 0 6px var(--color-primary);
  }

  button[type="submit"],
  #resetBtn {
    background: var(--color-primary);
    color: white;
    border: none;
    padding: 0.8rem 1.8rem;
    border-radius: 10px;
    font-size: 1.05rem;
    cursor: pointer;
    flex: 1 1 100%;
    max-width: 240px;
    font-weight: 600;
    transition: background-color 0.25s ease;
    align-self: flex-end;
  }

  button[type="submit"]:hover {
    background: var(--color-primary-dark);
  }

  #resetBtn {
    background: var(--color-error);
    margin-top: 0;
    margin-bottom: 1.5rem;
  }

  #resetBtn:hover {
    background: #c53030;
  }

  @media screen and (max-width: 600px) {
    form {
      display: flex;
      flex-direction: column;
      gap: 0.75rem; 
    }

    input[type="date"],
    input[type="number"],
    input[type="text"],
    button[type="submit"],
    #resetBtn {
      margin-top :0px;
      width: 100%;
      max-width: 100%;
      box-sizing: border-box;
    }

    button[type="submit"],
    #resetBtn {
      align-self: stretch;
    }
  }

  .chart-container {
    margin-bottom: 3rem;
  }
  h2 {
    font-weight: 600;
    color: var(--color-text);
    margin-bottom: 0.75rem;
    border-left: 5px solid var(--color-primary);
    padding-left: 0.75rem;
  }
  canvas {
    background: var(--color-chart-bg);
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(99, 99, 99, 0.05);
    width: 100% !important;
    max-height: 350px;
    transition: background 0.4s ease;
  }
</style>
</head>
<body>

<div class="toggle-wrapper" title="Toggle dark mode">
  <label class="toggle-label" for="darkModeToggle">Dark Mode</label>
  <label class="toggle-switch">
    <input type="checkbox" id="darkModeToggle" />
    <span class="slider"></span>
  </label>
</div>

<h1>ðŸ“š Study Time Tracker</h1>

<div class="container">
  <form id="studyForm" autocomplete="off">
    <label for="date">Date
      <input type="date" id="date" max="" required />
    </label>
    <label for="hours">Hours Studied
      <input type="number" id="hours" min="0" max="24" step="1" placeholder="e.g. 2" />
    </label>
    <label for="minutes">Minutes Studied
      <input type="number" id="minutes" min="0" max="59" step="1" placeholder="e.g. 30" />
    </label>
    <label for="subject">Subject (optional)
      <input type="text" id="subject" placeholder="Math, History, etc." />
    </label>
    <button type="submit">Add Entry</button>
  </form>

  <button id="resetBtn">Reset Data</button>

  <div class="chart-container">
    <h2>Daily Study Time (Hours)</h2>
    <canvas id="lineChart"></canvas>
  </div>

  <div class="chart-container">
    <h2>Weekly Study Time by Subject</h2>
    <canvas id="barChart"></canvas>
  </div>

  <div class="chart-container">
    <h2>Monthly Total Study Time</h2>
    <canvas id="monthlyLineChart"></canvas>
  </div>

  <div class="chart-container">
    <h2>Monthly Study Time by Subject</h2>
    <canvas id="pieChart"></canvas>
  </div>
</div>

<script>
  // Dark mode toggle
  const toggle = document.getElementById('darkModeToggle');
  const currentTheme = localStorage.getItem('theme');
  if (currentTheme === 'dark') {
    document.documentElement.setAttribute('data-theme', 'dark');
    toggle.checked = true;
  }
  toggle.addEventListener('change', () => {
    if (toggle.checked) {
      document.documentElement.setAttribute('data-theme', 'dark');
      localStorage.setItem('theme', 'dark');
    } else {
      document.documentElement.removeAttribute('data-theme');
      localStorage.setItem('theme', 'light');
    }
  });

  const form = document.getElementById('studyForm');
  const resetBtn = document.getElementById('resetBtn');

  let studyData = JSON.parse(localStorage.getItem('studyData')) || [];

  // Utilities for date formatting
  function formatDate(d) {
    return d.toISOString().slice(0, 10);
  }

  // Initialize the max attribute of date input to today (prevents future dates)
  function setDateMaxToToday() {
    const todayStr = formatDate(new Date());
    document.getElementById('date').max = todayStr;
  }

  // Add entry to data with validations
  form.addEventListener('submit', (e) => {
    e.preventDefault();

    const dateInput = document.getElementById('date').value;
    let hours = parseInt(document.getElementById('hours').value, 10);
    let minutes = parseInt(document.getElementById('minutes').value, 10);
    const subjectInput = document.getElementById('subject').value.trim();

    if (!dateInput) {
      alert('Please enter a date.');
      return;
    }
    // Check future date again as fallback
    const todayStr = formatDate(new Date());
    if (dateInput > todayStr) {
      alert('Date cannot be in the future.');
      return;
    }

    hours = isNaN(hours) ? 0 : hours;
    minutes = isNaN(minutes) ? 0 : minutes;

    if (hours < 0 || hours > 24) {
      alert('Hours must be between 0 and 24.');
      return;
    }
    if (minutes < 0 || minutes > 59) {
      alert('Minutes must be between 0 and 59.');
      return;
    }

    const totalHours = hours + minutes / 60;
    if (totalHours <= 0) {
      alert('Please enter a positive study time (hours or minutes).');
      return;
    }

    // Check that total time for the date (all subjects) <= 24
    // Calculate current total for that date except new entry's subject (in case of update)
    let currentDateTotal = 0;
    studyData.forEach(entry => {
      if (entry.date === dateInput) currentDateTotal += entry.hours;
    });

    // Check if this entry updates an existing subject entry (date + subject)
    const subj = subjectInput || 'General';
    const existingEntry = studyData.find(
      entry => entry.date === dateInput && entry.subject.toLowerCase() === subj.toLowerCase()
    );
    const currentEntryHours = existingEntry ? existingEntry.hours : 0;
    // New total would be: currentDateTotal - currentEntryHours + totalHours
    if ((currentDateTotal - currentEntryHours + totalHours) > 24) {
      alert('Total study time for the day cannot exceed 24 hours.');
      return;
    }

    // Add new entry or update existing
    if (existingEntry) {
      existingEntry.hours = totalHours;
    } else {
      studyData.push({
        date: dateInput,
        hours: totalHours,
        subject: subj
      });
    }

    saveAndUpdate();
    form.reset();
    document.getElementById('date').focus();
  });

  // Reset data with password prompt
  resetBtn.addEventListener('click', () => {
    const pw = prompt('Enter password to reset data:');
    if (pw === 'abc123') {
      studyData = [];
      saveAndUpdate();
      alert('Data reset successfully!');
    } else if (pw !== null) {
      alert('Incorrect password.');
    }
  });

  function saveAndUpdate() {
    localStorage.setItem('studyData', JSON.stringify(studyData));
    updateCharts();
  }

  // Helper: get week key string from date (ISO week)
  function getWeekKey(date) {
    const d = new Date(date);
    const target = new Date(d.valueOf());
    const dayNr = (d.getDay() + 6) % 7;
    target.setDate(target.getDate() - dayNr + 3);
    const firstThursday = target.valueOf();
    target.setMonth(0, 1);
    if (target.getDay() !== 4) {
      target.setMonth(0, 1 + ((4 - target.getDay()) + 7) % 7);
    }
    const weekNumber = 1 + Math.round((firstThursday - target) / (7 * 86400000));
    return `${d.getFullYear()}-W${weekNumber.toString().padStart(2, '0')}`;
  }

  // Helper: get month key string from date
  function getMonthKey(date) {
    const d = new Date(date);
    return `${d.getFullYear()}-${(d.getMonth() + 1).toString().padStart(2, '0')}`;
  }

  // Chart instances
  let lineChart, barChart, monthlyLineChart, pieChart;

  // Update all charts
  function updateCharts() {
    if (studyData.length === 0) {
      clearCharts();
      return;
    }

    // === Line chart: Daily total hours (all subjects combined) ===
    const dailyMap = new Map();
    studyData.forEach(({ date, hours }) => {
      dailyMap.set(date, (dailyMap.get(date) || 0) + hours);
    });
    const dailyDates = Array.from(dailyMap.keys()).sort();
    const dailyHours = dailyDates.map(d => dailyMap.get(d));

    const lineCtx = document.getElementById('lineChart').getContext('2d');
    if (lineChart) lineChart.destroy();
    lineChart = new Chart(lineCtx, {
      type: 'line',
      data: {
        labels: dailyDates,
        datasets: [{
          label: 'Hours',
          data: dailyHours,
          fill: true,
          backgroundColor: 'rgba(49,130,206,0.2)',
          borderColor: 'rgba(49,130,206,1)',
          borderWidth: 2,
          pointRadius: 3,
          pointHoverRadius: 6,
          tension: 0.3
        }]
      },
      options: {
        responsive: true,
        scales: {
          y: { beginAtZero: true, title: { display: true, text: 'Hours' } },
          x: { title: { display: true, text: 'Date' } }
        },
        plugins: {
          legend: { display: true },
          tooltip: { mode: 'index', intersect: false }
        }
      }
    });

    // === Bar chart: Weekly study time by subject (grouped bars) ===
    const weeklyMap = new Map();
    const subjectsSet = new Set();
    studyData.forEach(({ date, hours, subject }) => {
      const week = getWeekKey(date);
      subjectsSet.add(subject);
      if (!weeklyMap.has(week)) weeklyMap.set(week, new Map());
      const subjMap = weeklyMap.get(week);
      subjMap.set(subject, (subjMap.get(subject) || 0) + hours);
    });

    const weeks = Array.from(weeklyMap.keys()).sort();
    const subjects = Array.from(subjectsSet).sort();
    const colors = generateColors(subjects.length);

    const barDatasets = subjects.map((subj, i) => ({
      label: subj,
      data: weeks.map(w => {
        const subjMap = weeklyMap.get(w);
        return subjMap.get(subj) || 0;
      }),
      backgroundColor: colors[i],
      borderRadius: 6
    }));

    const barCtx = document.getElementById('barChart').getContext('2d');
    if (barChart) barChart.destroy();
    barChart = new Chart(barCtx, {
      type: 'bar',
      data: {
        labels: weeks,
        datasets: barDatasets
      },
      options: {
        responsive: true,
        scales: {
          y: { beginAtZero: true, title: { display: true, text: 'Hours' } },
          x: {
            title: { display: true, text: 'Week' },
            stacked: false
          }
        },
        plugins: {
          legend: { position: 'top' },
          tooltip: { mode: 'index', intersect: false }
        }
      }
    });

    // === Monthly line chart: total hours per month ===
    const monthlyMap = new Map();
    studyData.forEach(({ date, hours }) => {
      const month = getMonthKey(date);
      monthlyMap.set(month, (monthlyMap.get(month) || 0) + hours);
    });
    const months = Array.from(monthlyMap.keys()).sort();
    const monthlyTotals = months.map(m => monthlyMap.get(m));

    const monthlyLineCtx = document.getElementById('monthlyLineChart').getContext('2d');
    if (monthlyLineChart) monthlyLineChart.destroy();
    monthlyLineChart = new Chart(monthlyLineCtx, {
      type: 'line',
      data: {
        labels: months,
        datasets: [{
          label: 'Total Hours',
          data: monthlyTotals,
          fill: true,
          backgroundColor: 'rgba(99,179,130,0.3)',
          borderColor: 'rgba(56,161,105,1)',
          borderWidth: 2,
          pointRadius: 3,
          pointHoverRadius: 6,
          tension: 0.25
        }]
      },
      options: {
        responsive: true,
        scales: {
          y: { beginAtZero: true, title: { display: true, text: 'Hours' } },
          x: { title: { display: true, text: 'Month' } }
        },
        plugins: {
          legend: { display: true },
          tooltip: { mode: 'index', intersect: false }
        }
      }
    });

    // === Pie chart: monthly study time by subject (last month) ===
    const lastMonth = months[months.length - 1];
    if (lastMonth) {
      const subjectMonthlyMap = new Map();
      studyData.forEach(({ date, hours, subject }) => {
        if (getMonthKey(date) === lastMonth) {
          subjectMonthlyMap.set(subject, (subjectMonthlyMap.get(subject) || 0) + hours);
        }
      });
      const pieLabels = Array.from(subjectMonthlyMap.keys()).sort();
      const pieData = pieLabels.map(s => subjectMonthlyMap.get(s));
      const pieColors = generateColors(pieLabels.length);

      const pieCtx = document.getElementById('pieChart').getContext('2d');
      if (pieChart) pieChart.destroy();
      pieChart = new Chart(pieCtx, {
        type: 'pie',
        data: {
          labels: pieLabels,
          datasets: [{
            data: pieData,
            backgroundColor: pieColors
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: { position: 'right' },
            title: {
              display: true,
              text: `Study Time by Subject for ${lastMonth}`
            }
          }
        }
      });
    } else {
      if (pieChart) pieChart.destroy();
      document.getElementById('pieChart').getContext('2d').clearRect(0, 0, 400, 400);
    }
  }

  // Clear charts if no data
  function clearCharts() {
    if (lineChart) lineChart.destroy();
    if (barChart) barChart.destroy();
    if (monthlyLineChart) monthlyLineChart.destroy();
    if (pieChart) pieChart.destroy();
  }

  // Utility: generate array of distinct colors
  function generateColors(count) {
    const baseColors = [
      '#3182ce', '#e53e3e', '#d69e2e', '#38a169', '#805ad5', '#dd6b20', '#718096', '#2b6cb0', '#9f7aea', '#f6ad55'
    ];
    const colors = [];
    for (let i = 0; i < count; i++) {
      colors.push(baseColors[i % baseColors.length]);
    }
    return colors;
  }

  // Initialization
  setDateMaxToToday();
  updateCharts();

</script>

</body>
</html>



